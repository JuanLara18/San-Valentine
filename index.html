<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#0d0221" />
  <meta name="description" content="Love Quest - A retro pixel-art platformer to ask someone to be your Valentine" />
  <meta property="og:title" content="Love Quest üíï" />
  <meta property="og:description" content="A retro adventure of love. Play and discover the message!" />
  <meta property="og:type" content="website" />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect x='6' y='4' width='8' height='4' fill='%23ff1744'/%3E%3Crect x='18' y='4' width='8' height='4' fill='%23ff1744'/%3E%3Crect x='4' y='8' width='24' height='4' fill='%23ff1744'/%3E%3Crect x='4' y='12' width='24' height='4' fill='%23ff1744'/%3E%3Crect x='6' y='16' width='20' height='4' fill='%23ff1744'/%3E%3Crect x='8' y='20' width='16' height='4' fill='%23ff1744'/%3E%3Crect x='10' y='24' width='12' height='4' fill='%23ff1744'/%3E%3Crect x='14' y='28' width='4' height='4' fill='%23ff1744'/%3E%3Crect x='6' y='8' width='4' height='4' fill='%23ff6b9d' opacity='0.5'/%3E%3C/svg%3E" />
  <title>Love Quest üíï</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 100%; height: 100%; overflow: hidden;
      font-family: 'Press Start 2P', monospace;
      -webkit-tap-highlight-color: transparent;
      touch-action: none; user-select: none;
      background: #0d0221;
    }

    /* ===== DESKTOP LAYOUT ===== */
    .desktop-wrapper {
      width: 100%; height: 100%;
      display: flex; justify-content: center; align-items: center;
      position: relative; overflow: hidden;
    }

    /* Animated gradient background */
    .desktop-bg {
      position: absolute; inset: 0; z-index: 0;
      background: linear-gradient(135deg, #0d0221 0%, #1a0a2e 25%, #2d1b69 50%, #1a0a2e 75%, #0d0221 100%);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }
    @keyframes gradientShift {
      0%   { background-position: 0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* CSS stars */
    .stars-layer {
      position: absolute; inset: 0; z-index: 1;
      overflow: hidden; pointer-events: none;
    }
    .star {
      position: absolute; border-radius: 50%; background: white;
      animation: twinkle var(--duration) ease-in-out infinite;
      animation-delay: var(--delay);
    }
    @keyframes twinkle {
      0%, 100% { opacity: var(--min-opacity); transform: scale(1); }
      50% { opacity: 1; transform: scale(1.3); }
    }

    /* Floating hearts */
    .hearts-layer {
      position: absolute; inset: 0; z-index: 1;
      overflow: hidden; pointer-events: none;
    }
    .floating-heart {
      position: absolute; bottom: -30px;
      font-size: var(--size); color: var(--color); opacity: 0;
      animation: floatUp var(--duration) ease-in infinite;
      animation-delay: var(--delay);
    }
    @keyframes floatUp {
      0%   { transform: translateY(0) rotate(0deg); opacity: 0; }
      10%  { opacity: var(--max-opacity); }
      90%  { opacity: var(--max-opacity); }
      100% { transform: translateY(-110vh) rotate(var(--rotation)); opacity: 0; }
    }

    /* ===== GAME FRAME (desktop) ===== */
    .game-frame {
      position: relative; z-index: 10;
      padding: 12px;
      background: linear-gradient(145deg, #2d1b69, #1a0a2e);
      border-radius: 20px;
      border: 2px solid rgba(196, 77, 255, 0.3);
      box-shadow:
        0 0 40px rgba(196, 77, 255, 0.15),
        0 0 80px rgba(255, 64, 129, 0.08),
        inset 0 1px 0 rgba(255,255,255,0.05);
    }
    .game-frame::before {
      content: '';
      position: absolute; inset: -2px; border-radius: 22px;
      background: linear-gradient(135deg, #c44dff33, #ff408133, #c44dff33);
      z-index: -1;
      animation: borderGlow 4s ease-in-out infinite;
    }
    @keyframes borderGlow {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    /* Game container - DESKTOP: large canvas */
    #game-container {
      border-radius: 10px;
      overflow: hidden;
      line-height: 0;
      /* Desktop: 88vh tall, width from aspect ratio (2:3) */
      height: 88vh;
      width: calc(88vh * 2 / 3);
    }
    canvas {
      display: block;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }

    /* ===== SIDE PANELS ===== */
    .side-panel {
      position: relative; z-index: 5;
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      padding: 0 40px; gap: 30px;
      color: #c44dff; text-align: center;
    }
    .side-panel.left { align-items: flex-end; }
    .side-panel.right { align-items: flex-start; }

    .side-title {
      font-size: 24px; color: #ff6b9d;
      text-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
      line-height: 1.4;
    }
    .side-subtitle {
      font-size: 9px; color: #c44dff;
      opacity: 0.7; line-height: 1.8;
    }
    .side-heart {
      font-size: 40px;
      animation: heartPulse 1.5s ease-in-out infinite;
      filter: drop-shadow(0 0 15px rgba(255, 64, 129, 0.6));
    }
    @keyframes heartPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }
    .side-controls {
      font-size: 7px; color: #9c27b0;
      line-height: 2.4; opacity: 0.6; text-align: left;
    }
    .side-controls span { color: #ff6b9d; font-size: 8px; }
    .pixel-divider {
      width: 80px; height: 2px;
      background: linear-gradient(90deg, transparent, #c44dff, transparent);
      opacity: 0.4;
    }

    /* ===== MOBILE TOUCH CONTROLS ===== */
    .mobile-controls {
      display: none; /* hidden on desktop */
    }

    /* ===== MOBILE LAYOUT ===== */
    @media (max-width: 768px), (pointer: coarse) and (max-width: 1024px) {
      /* Hide desktop decorations */
      .desktop-bg, .stars-layer, .hearts-layer,
      .side-panel, .game-frame::before { display: none !important; }

      .desktop-wrapper {
        flex-direction: column;
        background: #0d0221;
      }
      .game-frame {
        padding: 0; border-radius: 0;
        border: none; background: none;
        box-shadow: none;
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 0;
      }
      #game-container {
        border-radius: 0;
        /* Fill available width, height auto from aspect ratio */
        width: 100vw;
        height: calc(100vw * 3 / 2); /* 2:3 aspect ratio */
        max-height: calc(100vh - 110px); /* Leave room for controls */
        max-width: calc((100vh - 110px) * 2 / 3); /* Constrain width if height-limited */
      }

      /* Show mobile controls */
      .mobile-controls {
        display: flex;
        position: relative; z-index: 100;
        width: 100%;
        height: 110px;
        flex-shrink: 0;
        background: linear-gradient(180deg, #1a0a2e, #0d0221);
        border-top: 1px solid rgba(196, 77, 255, 0.2);
        align-items: center;
        justify-content: space-between;
        padding: 8px 20px;
      }
      .ctrl-group {
        display: flex; align-items: center; gap: 8px;
      }
      .ctrl-btn {
        display: flex; align-items: center; justify-content: center;
        border: 2px solid rgba(255, 107, 157, 0.4);
        border-radius: 50%;
        background: rgba(45, 27, 105, 0.6);
        color: rgba(255, 255, 255, 0.8);
        font-size: 22px;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
        transition: background 0.1s, border-color 0.1s, transform 0.1s;
      }
      .ctrl-btn:active, .ctrl-btn.active {
        background: rgba(255, 64, 129, 0.4);
        border-color: #ff4081;
        transform: scale(0.92);
      }
      .ctrl-dpad {
        width: 64px; height: 64px;
        font-size: 24px;
      }
      .ctrl-jump {
        width: 80px; height: 80px;
        font-size: 28px;
        border-color: rgba(255, 64, 129, 0.5);
        background: rgba(255, 64, 129, 0.15);
      }
      .ctrl-jump:active, .ctrl-jump.active {
        background: rgba(255, 64, 129, 0.5);
      }
      .ctrl-label {
        font-family: 'Press Start 2P', monospace;
        font-size: 6px;
        color: rgba(196, 77, 255, 0.5);
        text-align: center;
        margin-top: 4px;
      }
    }

    /* Medium screens: hide side panels, keep frame */
    @media (max-width: 1100px) and (min-width: 769px) {
      .side-panel { display: none; }
    }

    /* Very small height (landscape phone): compact controls */
    @media (max-height: 500px) {
      .mobile-controls { height: 70px; padding: 4px 16px; }
      .ctrl-dpad { width: 48px; height: 48px; font-size: 18px; }
      .ctrl-jump { width: 60px; height: 60px; font-size: 22px; }
      #game-container {
        max-height: calc(100vh - 70px);
        max-width: calc((100vh - 70px) * 2 / 3);
      }
    }
  </style>
</head>
<body>
  <div class="desktop-wrapper">
    <!-- Animated background (desktop only) -->
    <div class="desktop-bg"></div>
    <div class="stars-layer" id="stars"></div>
    <div class="hearts-layer" id="hearts"></div>

    <!-- Left panel (desktop only) -->
    <div class="side-panel left">
      <div class="side-heart">üíï</div>
      <div class="side-title">Love<br>Quest</div>
      <div class="pixel-divider"></div>
      <div class="side-subtitle">A retro adventure<br>of love</div>
    </div>

    <!-- Game -->
    <div class="game-frame">
      <div id="game-container"></div>
    </div>

    <!-- Right panel (desktop only) -->
    <div class="side-panel right">
      <div class="side-heart">‚ú®</div>
      <div class="side-controls">
        <span>‚Üê‚Üí</span> Move<br>
        <span> ‚Üë </span> Jump<br>
        <span> W </span> Wall Jump<br>
        <br>
        Collect all the<br>
        hearts to advance!
      </div>
      <div class="pixel-divider"></div>
      <div class="side-subtitle">Collect hearts<br>Avoid enemies<br>Find the message</div>
      <div class="side-heart" style="font-size: 28px; animation-delay: 0.5s;">üíù</div>
    </div>
  </div>

  <!-- Mobile touch controls (hidden on desktop) -->
  <div class="mobile-controls">
    <div class="ctrl-group">
      <div>
        <div class="ctrl-btn ctrl-dpad" id="btn-left">‚óÄ</div>
        <div class="ctrl-label">LEFT</div>
      </div>
      <div>
        <div class="ctrl-btn ctrl-dpad" id="btn-right">‚ñ∂</div>
        <div class="ctrl-label">RIGHT</div>
      </div>
    </div>
    <div class="ctrl-group">
      <div>
        <div class="ctrl-btn ctrl-jump" id="btn-jump">‚ñ≤</div>
        <div class="ctrl-label">JUMP</div>
      </div>
    </div>
  </div>

  <!-- Initialize global mobile input + decorations -->
  <script>
    // Global mobile input state (read by Phaser Player entity)
    window.__mobileInput = { left: false, right: false, jump: false };

    // Wire up touch controls with multi-touch support
    function bindControl(id, key) {
      var el = document.getElementById(id);
      if (!el) return;
      el.addEventListener('touchstart', function(e) {
        e.preventDefault();
        window.__mobileInput[key] = true;
        el.classList.add('active');
      }, { passive: false });
      el.addEventListener('touchend', function(e) {
        e.preventDefault();
        window.__mobileInput[key] = false;
        el.classList.remove('active');
      }, { passive: false });
      el.addEventListener('touchcancel', function() {
        window.__mobileInput[key] = false;
        el.classList.remove('active');
      });
      // Also handle mouse for testing on desktop
      el.addEventListener('mousedown', function() {
        window.__mobileInput[key] = true;
        el.classList.add('active');
      });
      el.addEventListener('mouseup', function() {
        window.__mobileInput[key] = false;
        el.classList.remove('active');
      });
      el.addEventListener('mouseleave', function() {
        window.__mobileInput[key] = false;
        el.classList.remove('active');
      });
    }
    bindControl('btn-left', 'left');
    bindControl('btn-right', 'right');
    bindControl('btn-jump', 'jump');

    // Generate CSS stars
    (function() {
      var starsEl = document.getElementById('stars');
      for (var i = 0; i < 80; i++) {
        var s = document.createElement('div');
        s.className = 'star';
        var size = Math.random() * 2.5 + 1;
        s.style.cssText =
          'width:'+size+'px;height:'+size+'px;'+
          'left:'+Math.random()*100+'%;top:'+Math.random()*100+'%;'+
          '--duration:'+(1.5+Math.random()*3)+'s;'+
          '--delay:'+Math.random()*4+'s;'+
          '--min-opacity:'+(0.15+Math.random()*0.35)+';';
        starsEl.appendChild(s);
      }
      // Floating hearts
      var heartsEl = document.getElementById('hearts');
      var symbols = ['‚ô•','‚ô•','üíï','‚ú¶','‚ô•','üíó'];
      var colors = ['#ff1744','#ff4081','#ff6b9d','#c44dff','#e91e63','#f48fb1'];
      for (var i = 0; i < 18; i++) {
        var h = document.createElement('div');
        h.className = 'floating-heart';
        h.textContent = symbols[i % symbols.length];
        h.style.cssText =
          'left:'+Math.random()*100+'%;'+
          '--size:'+(10+Math.random()*18)+'px;'+
          '--color:'+colors[i % colors.length]+';'+
          '--duration:'+(8+Math.random()*12)+'s;'+
          '--delay:'+Math.random()*15+'s;'+
          '--max-opacity:'+(0.15+Math.random()*0.25)+';'+
          '--rotation:'+(-30+Math.random()*60)+'deg;';
        heartsEl.appendChild(h);
      }
    })();
  </script>
  <script type="module" src="/src/main.ts"></script>
</body>
</html>
